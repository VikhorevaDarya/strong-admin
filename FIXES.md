# Исправления багов авторизации

## Проблема
При переходе между вкладками админки происходил logout и требовалась повторная авторизация.

## Причины
1. Токен PocketBase не сохранялся корректно в localStorage
2. Токен не обновлялся автоматически
3. React-admin делает множество проверок авторизации, что могло приводить к конфликтам

## Решение

### 1. dataProvider.js
- Добавлено восстановление сессии из localStorage при загрузке приложения
- Настроен автоматический сохранение токена и данных пользователя в localStorage при любых изменениях authStore
- Добавлено автоматическое обновление токена каждые 5 минут (фоновый процесс)
- Отключена автоматическая отмена запросов (`pb.autoCancellation(false)`)

### 2. authProvider.js
- Добавлено кэширование проверок авторизации (не чаще 1 раза в минуту)
- Добавлен метод автоматического обновления токена при проверке авторизации
- Улучшена обработка ошибок при обновлении токена

## Как это работает

### При входе в систему:
1. Пользователь вводит логин и пароль
2. PocketBase выдает токен
3. Токен автоматически сохраняется в localStorage
4. Запускается фоновый процесс обновления токена

### При переходе между вкладками:
1. React-admin вызывает `checkAuth()`
2. Проверяется время последней проверки
3. Если прошло больше 1 минуты, токен обновляется
4. Сессия продолжается без logout

### При обновлении страницы:
1. Приложение загружается
2. Токен восстанавливается из localStorage
3. Проверяется валидность токена
4. Пользователь остается авторизованным

### Автоматическое обновление:
- Каждые 5 минут токен автоматически обновляется в фоновом режиме
- Это гарантирует, что токен никогда не истечет во время активной работы

## Настройки

Вы можете изменить интервалы обновления в файлах:

**authProvider.js:**
```javascript
const AUTH_CHECK_INTERVAL = 60000; // 1 минута (в миллисекундах)
```

**dataProvider.js:**
```javascript
}, 5 * 60 * 1000); // 5 минут (в миллисекундах)
```

## Примечания

- Токен сохраняется в localStorage под ключом `pocketbase_auth`
- При logout токен автоматически удаляется из localStorage
- Если обновление токена не удалось, но токен еще валиден, доступ разрешается
- Если токен полностью невалиден, происходит автоматический logout
