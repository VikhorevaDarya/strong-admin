# Настройка поля products_name в PocketBase

## Что это поле делает

Поле `products_name` в коллекции `warehouses` автоматически заполняется списком названий всех товаров на складе через запятую.

**Пример:**
```
products_name: "Скутер A, Скутер B, Аксессуар, Шлем"
```

## Создание поля в PocketBase

### Шаг 1: Откройте PocketBase Admin

1. Запустите PocketBase (если не запущен)
2. Откройте браузер: http://127.0.0.1:8090/_/
3. Войдите с учетными данными суперпользователя

### Шаг 2: Добавьте поле в коллекцию warehouses

1. Перейдите в **Collections** → **warehouses**
2. Нажмите кнопку **Add Field** (или редактируйте коллекцию)
3. Выберите тип поля: **Text**

### Шаг 3: Настройте параметры поля

**Обязательные настройки:**
- **Name:** `products_name`
- **Type:** Text
- **Required:** ❌ (НЕ включайте, поле опциональное)

**Опциональные настройки:**
- **Presentable:** ✅ (рекомендуется включить)
- **Min length:** оставить пустым
- **Max length:** оставить пустым (или поставить большое значение, например 10000)
- **Pattern:** оставить пустым

### Шаг 4: Сохраните изменения

1. Нажмите **Save** или **Create**
2. PocketBase автоматически применит изменения к схеме

## Проверка поля

После создания поля:

1. Откройте коллекцию **warehouses** в PocketBase Admin
2. Выберите любой склад
3. Проверьте, что появилось поле `products_name`
4. Оно должно быть пустым (заполнится автоматически)

## Автоматическое заполнение

После создания поля система автоматически заполнит его при:

1. **Создании товара** → склад обновится, добавится название нового товара
2. **Редактировании товара** → если изменилось название или склад
3. **Удалении товара** → склад обновится, название удалится
4. **Импорте из Excel** → все склады обновятся

## Первичное заполнение существующих складов

Если у вас уже есть товары и склады, выполните пересчет через консоль:

```javascript
// Откройте консоль браузера (F12) на странице приложения
const { recalculateAllWarehousesCount } = await import('./src/utils/warehouse.utils.js');

await recalculateAllWarehousesCount();

console.log('✅ Поле products_name заполнено для всех складов!');
window.location.reload();
```

## Формат данных

**Если товары есть:**
```
"Скутер Xiaomi Pro, Скутер Ninebot Max, Шлем защитный"
```

**Если товары с одинаковыми названиями:**
```
"Скутер A, Скутер A, Аксессуар"
```
(Дубликаты сохраняются, так как это разные товары)

**Если товаров нет:**
```
""
```
(Пустая строка)

**Если товар без названия:**
```
"Без названия"
```

## Использование поля

### В таблице складов

Вы можете добавить колонку для отображения списка товаров:

**Файл:** `client/src/resources/warehouses/WarehouseList.tsx`

```typescript
<Datagrid>
  <TextField source="id" label="ID" />
  <TextField source="name" label="Название склада" />
  <TextField source="address" label="Адрес" />
  <NumberField source="products_count" label="Количество товаров" emptyText="0" />
  <TextField source="products_name" label="Товары" /> {/* Новая колонка */}
  <EditButton label="Редактировать" />
  <DeleteButton label="Удалить" />
</Datagrid>
```

### Для фильтрации

Вы можете использовать это поле для поиска склада по названию товара:

```typescript
<Filter {...props}>
  <TextInput label="Поиск по товару" source="products_name" />
</Filter>
```

## Максимальная длина

Если у вас очень много товаров на одном складе (например, 100+), строка может стать очень длинной.

**Рекомендации:**

1. Установите **Max length** в PocketBase на большое значение (10000-50000)
2. Или обрежьте список в коде до первых N товаров:

```typescript
// В warehouse.utils.ts
const productsNames = products
  .slice(0, 50) // Только первые 50 товаров
  .map((product) => product.name || 'Без названия')
  .join(', ');

if (products.length > 50) {
  productsNames += ` и еще ${products.length - 50}...`;
}
```

## Устранение ошибок

### Поле не создается

**Причина:** Неправильный тип поля
**Решение:** Убедитесь, что выбран тип **Text**, а не Editor или другой

### Поле не заполняется автоматически

**Причина:** Поле не существует или неправильное название
**Решение:** Проверьте, что поле называется именно `products_name` (с подчеркиванием)

### Ошибка "Field validation failed"

**Причина:** Установлен флаг **Required**
**Решение:** Снимите галочку **Required**, поле должно быть опциональным

### Строка обрезается

**Причина:** Установлено ограничение **Max length**
**Решение:** Увеличьте **Max length** или уберите ограничение

## Итого

После настройки поля `products_name`:

✅ Автоматически обновляется при любых операциях с товарами
✅ Содержит актуальный список названий товаров
✅ Можно использовать для поиска и отображения
✅ Не требует ручного заполнения

Поле синхронизировано с `products_count` и обновляется одновременно с ним.
